<!DOCTYPE html>
<html lang='en'>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>One Apostrophe Arabic Transliteration</title>
</head>
<body>
	<h1>Arabic to Latin Transliteration</h1>
	<h2>Under construction little works yet.</h2>
	<div id='arabicScriptRegion'>
		<label for='arabicScriptText'>Put text in Arabic script here.</label>
		<textarea id='arabicScriptText' dir="rtl" lang="ar" aria-live="assertive"></textarea>
		<input type='button' id='romanizeButton' value="Convert to Latin Script"/>
	</div>
	<div>
		<label for='latinScriptText'>Put text in Latin script here.</label>
		<textarea id='latinScriptText' dir="ltr" lang="en" aria-live="assertive"></textarea>
		<input type='button' id='arabizeButton' value="Convert to Arabic Script"/>
	</div>
	<input type='button' id='startDeveloperModeButton'value ="Start Developer Mode"/>
	<div id="developerPanel" style="visibility: collapse;">
		<input type='button' id='testButton' value="Run Unit Tests"/>
		<div id="testResultLabel"></div>
	</div>
	<script>
		// pre-romanization exclusion characters are arabic characters that must be deleted before
		// romanization is started. They have no use in the Latin script.
		const preRomanizationExclusions = 
			[
			'\u0640' // ARABIC TATWEEL
			];

		const transliterationTable = 
			[
			["y'i", '\u0625\u0650'] // ARABIC LETTER ALEF WITH HAMZA BELOW followed by ARABIC KASRA
			,["y'i", '\u0625'] // ARABIC LETTER ALEF WITH HAMZA BELOW
			,["y'aa", '\u0622'] // ARABIC LETTER ALEF WITH MADDA ABOVE
			,["y'", '\u0623'] // ARABIC LETTER ALEF WITH HAMZA ABOVE
			,["y'", '\u0621'] // ARABIC LETTER HAMZA
			,["y'", '\u0624'] // ARABIC LETTER WAW WITH HAMZA ABOVE
			,["y'", '\u0626'] // ARABIC LETTER YEH WITH HAMZA ABOVE
			,["aa", '\u064e\u0627'] // ARABIC FATHA then ARABIC LETTER ALEF
			,["aa", '\u064e\u0649'] // ARABIC FATHA then ARABIC LETTER ALEF MAKSURA
			,["aa", '\u0649'] // ARABIC LETTER ALEF MAKSURA
			,["b", '\u0628'] // ARABIC LETTER BEH
			,["-t", '\u0629'] // ARABIC LETTER TEH MARBUTA
			,["t'", '\u0637'] // ARABIC LETTER TAH
			,["th'", '\u062b\u062d'] // ARABIC LETTER TEH then ARABIC LETTER HAH
			,["th", '\u062b'] // ARABIC LETTER THEH
			,["t", '\u062a'] // ARABIC LETTER TEH
			,["j", '\u062c'] // ARABIC LETTER JEEM
			,["h'", '\u062d'] // ARABIC LETTER HAH
			,["kh", '\u062e'] // ARABIC LETTER KHAH
			,["dh'", '\u062f\u062d'] // ARABIC LETTER DAL then ARABIC LETTER HAH
			,["dh", '\u0630'] // ARABIC LETTER DHAL
			,["d'", '\u0636'] // ARABIC LETTER DAD
			,["d", '\u062f'] // ARABIC LETTER DAL
			,["r", '\u0631'] // ARABIC LETTER REH
			,["z'", '\u0638'] // ARABIC LETTER ZAH
			,["z", '\u0632'] // ARABIC LETTER ZAIN
			,["sh'", '\u0633\u062d'] // ARABIC LETTER SHEEN then ARABIC LETTER HAH
			,["sh", '\u0634'] // ARABIC LETTER SHEEN
			,["s'", '\u0635'] // ARABIC LETTER SAD
			,["s", '\u0633'] // ARABIC LETTER SEEN
			,["a'", '\u0639'] // ARABIC LETTER AIN
			,["gh", '\u063a'] // ARABIC LETTER GHAIN
			,["f", '\u0641'] // ARABIC LETTER FEH
			,["q", '\u0642'] // ARABIC LETTER QAF
			,["k", '\u0643'] // ARABIC LETTER KAF
			,["l", '\u0644'] // ARABIC LETTER LAM
			,["m", '\u0645'] // ARABIC LETTER MEEM
			,["n", '\u0646'] // ARABIC LETTER NOON
			,["h", '\u0647'] // ARABIC LETTER HEH
			,["w", '\u0648'] // ARABIC LETTER WAW
			,["y", '\u064a'] // ARABIC LETTER YEH
			,["a-n", '\u064b'] // ARABIC FATHATAN
			,["u-n", '\u064c'] // ARABIC DAMMATAN
			,["i-n", '\u064d'] // ARABIC KASRATAN
			,["a", '\u064e'] // ARABIC FATHA
			,["u", '\u064f'] // ARABIC DAMMA
			];
		const LATIN_COLUMN = 0;
		const ARABIC_COLUMN = 1;

		function setArabicText(text)
		{
			document.getElementById('arabicScriptText').value = text;
		}

		function getArabicText()
		{
			return document.getElementById('arabicScriptText').value;
		}

		function setLatinText(text)
		{
			document.getElementById('latinScriptText').value = text;
		}

		function getLatinText()
		{
			return document.getElementById('latinScriptText').value;
		}

		function romanizeNextChunk(arabicText)
		{
			for (var i = 0; i < transliterationTable.length; i++)
			{
				const arabicChunk = transliterationTable[i][ARABIC_COLUMN];
				const latinChunk = transliterationTable[i][LATIN_COLUMN];

				if (arabicText.startsWith(arabicChunk))
				{
					// Transliterate the next arabic chunk.
					// Also return the rest of the Arabic text.
					return [latinChunk, arabicText.substring(arabicChunk.length)];
				}
			}

			// return the next character as is, and everything else
			return [arabicText.charAt(0), arabicText.substring(1)];
		}

		function arabizeNextChunk(latinText)
		{
			for (var i = 0; i < transliterationTable.length; i++)
			{
				const arabicChunk = transliterationTable[i][ARABIC_COLUMN];
				const latinChunk = transliterationTable[i][LATIN_COLUMN];

				if (latinText.startsWith(latinChunk))
				{
					// Transliterate the next Latin chunk.
					// Also return the rest of the Latin text.
					return [arabicChunk, latinText.substring(latinChunk.length)];
				}
			}

			// return the next character as is, and everything else
			return [latinText.charAt(0), latinText.substring(1)];
		}

		function romanizationPreprocessing(text)
		{
			for (var i = 0; i < preRomanizationExclusions.length; i++)
			{
				text = text.replaceAll(preRomanizationExclusions[i], '');
			}
			return text;
		}

		function romanizeText(arabicText)
		{
			var latinText = "";
			arabicText = romanizationPreprocessing(arabicText)

			while (arabicText.length > 0)
			{
				var chunk = romanizeNextChunk(arabicText);
				latinText += chunk[0];
				arabicText = chunk[1];
			}

			return latinText;
		}

		function arabizeText(latinText)
		{
			var arabicText = "";

			while (latinText.length > 0)
			{
				var chunk = arabizeNextChunk(latinText);
				arabicText += chunk[0];
				latinText = chunk[1];
			}

			return arabicText;
		}

		function romanize()
		{
			var arabicText = getArabicText();
			var latinText = romanizeText(arabicText);
			setLatinText(latinText)
		}

		function arabize()
		{
			var latinText = getLatinText();
			var arabicText = arabizeText(latinText);
			setArabicText(arabicText);
		}

		function startDeveloperMode()
		{
			document.getElementById('developerPanel').style = "visibility: visible;";
		}
		function getUnitTestResults()
		{
			return 'Unit tests are not implemented yet.';
		}

		function runUnitTests()
		{
			document.getElementById('testResultLabel').innerText = getUnitTestResults();
		}

		document.getElementById('romanizeButton').onclick = romanize;
		document.getElementById('arabizeButton').onclick = arabize;

		document.getElementById('startDeveloperModeButton').onclick = startDeveloperMode;

		document.getElementById('testButton').onclick = runUnitTests;
	</script>
</body>
</html>